<div class="market-index">
  <div class="market-index-container container mt-1">
    <div class="d-flex justify-content-between align-items-center m-1">
      <h1>Mercado</h1> <%= link_to "Voltar", @team, class: "back-btn btn btn-outline-light" %>
    </div>

    <div class="row">

      <div class="col-md-6">
        <div class="player-box-sell card">
          <div class="card-header">
            <h5>Seus Jogadores</h5>
            <small>Venda e compre jogadores do mercado</small>
          </div>
          <div class="market-card-sell card-body">
            <% if @my_players.any? %>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th><%= sortable "name", "Nome" %></th>
                      <th>
                        <div class="d-flex justify-content-center align-items-center">
                          <%= sortable "position", "P" %>
                          <div class="dropdown">
                            <button class="btn btn-link text-white p-0 ms-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fa-solid fa-filter" style="font-size: 0.7rem;"></i>
                            </button>
                            <ul class="dropdown-menu">
                              <li><%= link_to "Todas", request.query_parameters.merge(position: nil), class: "dropdown-item text-dark"%></li>
                              <% Player::POSITION_NAMES.each do |key, value| %>
                                <li><%= link_to value, request.query_parameters.merge(position: key), class: "dropdown-item text-dark" %></li>
                              <% end %>
                            </ul>
                          </div>
                        </div>
                      </th>
                      <th>
                        <div class="d-flex justify-content-center align-items-center">
                          L
                          <div class="dropdown">
                            <button class="btn btn-link text-white p-0 ms-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fa-solid fa-filter" style="font-size: 0.7rem;"></i>
                            </button>
                            <ul class="dropdown-menu">
                              <li><%= link_to "Todos", request.query_parameters.merge(level_min: nil, level_max: nil), class: "dropdown-item text-primary" %></li>
                              <li><%= link_to "1-2", request.query_parameters.merge(level_min: 1, level_max: 2), class: "dropdown-item text-danger" %></li>
                              <li><%= link_to "3-5", request.query_parameters.merge(level_min: 3, level_max: 5), class: "dropdown-item text-warning" %></li>
                              <li><%= link_to "6-9", request.query_parameters.merge(level_min: 6, level_max: 9), class: "dropdown-item text-success" %></li>
                              <li><%= link_to "10", request.query_parameters.merge(level_min: 10, level_max: 10), class: "dropdown-item text-info" %></li>
                            </ul>
                          </div>
                        </div>
                      </th>
                      <th><%= sortable "market_value", "$" %></th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @my_players.each do |player| %>
                      <tr>
                        <td><%= player.name %></td>
                        <td><small class="badge bg-dark"><%= player.position %></small></td>
                        <td>
                          <% if player.level < 3 %>
                            <small class="badge bg-danger"><%= player.level %></small>
                          <% elsif player.level < 6 %>
                            <small class="badge bg-warning"><%= player.level %></small>
                          <% elsif player.level < 10 %>
                            <small class="badge bg-success"><%= player.level %></small>
                          <% else %>
                            <small class="badge bg-info"><%= player.level %></small>
                          <% end %>
                        </td>
                        <td>$<%= number_with_delimiter(player.market_value) %></td>
                        <td>
                          <%= button_to "Vender", sell_player_team_market_path(team_id: @team.id, id: player.id),
                                method: :post,
                                data: { action: "click->sell-confirmation#confirm", "sell-confirmation-message-value": "Deseja vender #{player.name} por $#{number_with_delimiter(player.market_value)}?" },
                                class: "btn btn-sm btn-outline-warning action-button", form: { data: { controller: "sell-confirmation" }, class: 'd-inline' } %>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
            <% end %>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="player-box-buy card">
          <div class="card-header">
            <h5>Jogadores à venda</h5>
            <small>Orçamento disponível: $<strong><%= number_with_delimiter(@team.budget) %></strong></small>
          </div>
          <div class="market-card-buy card-body">
            <% if @available_players.any? %>
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th><%= sortable "name", "Nome" %></th>
                      <th>
                        <div class="d-flex justify-content-center align-items-center">
                          <%= sortable "position", "P" %>
                          <div class="dropdown">
                            <button class="btn btn-link text-white p-0 ms-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fa-solid fa-filter" style="font-size: 0.7rem;"></i>
                            </button>
                            <ul class="dropdown-menu">
                              <li><%= link_to "Todas", request.query_parameters.merge(position: nil), class: "dropdown-item text-dark" %></li>
                              <% Player::POSITION_NAMES.each do |key, value| %>
                                <li><%= link_to value, request.query_parameters.merge(position: key), class: "dropdown-item text-dark" %></li>
                              <% end %>
                            </ul>
                          </div>
                        </div>
                      </th>
                      <th>
                        <div class="d-flex justify-content-center align-items-center">
                          L
                          <div class="dropdown">
                            <button class="btn btn-link text-white p-0 ms-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fa-solid fa-filter" style="font-size: 0.7rem;"></i>
                            </button>
                            <ul class="dropdown-menu">
                              <li><%= link_to "Todos", request.query_parameters.merge(level_min: nil, level_max: nil), class: "dropdown-item text-primary" %></li>
                              <li><%= link_to "1-2", request.query_parameters.merge(level_min: 1, level_max: 2), class: "dropdown-item text-danger" %></li>
                              <li><%= link_to "3-5", request.query_parameters.merge(level_min: 3, level_max: 5), class: "dropdown-item text-warning" %></li>
                              <li><%= link_to "6-9", request.query_parameters.merge(level_min: 6, level_max: 9), class: "dropdown-item text-success" %></li>
                              <li><%= link_to "10", request.query_parameters.merge(level_min: 10, level_max: 10), class: "dropdown-item text-info" %></li>
                            </ul>
                          </div>
                        </div>
                      </th>
                      <th><%= sortable "market_value", "$" %></th>
                      <th scope="col"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @available_players.each do |player| %>
                      <tr>
                        <td><%= player.name %></td>
                        <td><small class="badge bg-dark"><%= player.position %></small></td>
                        <td>
                          <% if player.level < 3 %>
                            <small class="badge bg-danger"><%= player.level %></small>
                          <% elsif player.level < 6 %>
                            <small class="badge bg-warning"><%= player.level %></small>
                          <% elsif player.level < 10 %>
                            <small class="badge bg-success"><%= player.level %></small>
                          <% else %>
                            <small class="badge bg-info"><%= player.level %></small>
                          <% end %>
                        </td>
                        <td>$<%= number_with_delimiter(player.market_value) %></td>
                        <td>
                          <% if @team.budget >= player.market_value %>
                              <%= button_to "Comprar", buy_player_team_market_path(team_id: @team.id, id: player.id),
                                    method: :post,
                                    data: { action: "click->buy-confirmation#confirm", "buy-confirmation-message-value": "Deseja comprar #{player.name} por $#{number_with_delimiter(player.market_value)}?" },
                                    class: "btn btn-sm btn-outline-light action-button", form: { data: { controller: "buy-confirmation" }, class: 'd-inline' } %>
                          <% else %>
                            <span>Sem orçamento</span>
                          <% end %>
                        </td>
                      </tr>
                    <% end %>
                  </tbody>
                </table>
              </div>
            <% else %>
            <% end %>
          </div>
        </div>
      </div>

    </div>

    <div class="mt-4">
      <%= link_to "Voltar", @team, class: "back-btn btn btn-outline-light" %>
    </div>
  </div>
</div>
