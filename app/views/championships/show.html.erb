<div class="championship-show">
    <div class="championship-show-container container">
        <div class="d-flex justify-content-between">
            <h1><%= @championship.name %></h1>
            <div class="d-flex align-items-center">
                <%= link_to "Voltar", @team, class: "match-back-btn btn btn-outline-light" %>
            </div>
        </div>
        <% next_playable_round = @championship.matches.scheduled.where("home_team_id = ? OR away_team_id = ?", @team.id, @team.id).minimum(:round) %>
        <% @championship.matches.order(:round).group_by(&:round).each do |round, matches| %>
        <% round_finished = matches.all? { |m| m.status == 'finished' } %>
        <div class="championship-show-card-body text-center <%= 'finished' if round_finished %>">
            <div class="d-flex justify-content-between align-items-center p-0 m-0">
                <h3 class="m-0 mb-1 p-0 mt-1">Rodada</h3>
                <h3 class="badge bg-success m-0 ms-1 mt-1" style="font-size: 1.3em;"><%= round %></h3>
            </div>
            <h3 class="m-0 mb-1 p-0">
            <% if matches.first.match_date %>
                <small class="match-date bg-secondary text-white rounded fw-bold ps-4 pe-4 p-1"><%= matches.first.match_date.strftime("%d/%m/%Y %H:%M") %></small>
            <% end %>
            </h3>
            <% if round == next_playable_round && match_to_play = matches.find { |m| m.status == 'scheduled' && (m.home_team_id == @team.id || m.away_team_id == @team.id) } %>
                <%= button_to "Jogar Rodada", play_round_team_match_path(@team, match_to_play), method: :post, class: "btn btn-outline-light btn-sm", id: "active-round-btn" %>
            <% end %>
            <div class="last-matches-container <%= 'finished' if round_finished %>">
                <% matches.each do |match| %>
                    <div class="last-matches-row mb-1 <%= 'finished' if round_finished %>">
                        <div class="match-details">
                            <div class="last-results">
                                <div class="team-home">
                                    <% if match.home_team.user %>
                                        <span class="badge bg-light text-success" style="font-size: 0.6em;">Seu time</span><br>
                                    <% end %>
                                    <%= match.home_team.name %>
                                </div>
                                <div class="goals"><strong><%= match.home_goals %></strong></div>
                                <div class="result-badge">
                                    <span class="badge bg-light">X</span>
                                </div>
                                <div class="goals"><strong><%= match.away_goals %></strong></div>
                                <div class="team-away">
                                    <% if match.away_team.user %>
                                        <span class="badge bg-light text-success" style="font-size: 0.6em;">Seu time</span><br>
                                    <% end %>
                                    <%= match.away_team.name %>
                                </div>
                            </div>
                        </div>
                    </div>
                <% end %>
            </div>
        </div>
        <% end %>

    </div>
</div>

<script>
  document.addEventListener("turbo:load", function() {
    const activeBtn = document.getElementById("active-round-btn");
    if (activeBtn) {
      const yOffset = -115;
      const y = activeBtn.getBoundingClientRect().top + window.scrollY + yOffset;
      window.scrollTo({ top: y, behavior: "smooth" });
    }
  });
</script>
